<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Mapping by MrAntix</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Mapping</h1>
        <p>A container for DRY object mapping</p>

        <p class="view"><a href="https://github.com/MrAntix/Mapping">View the Project on GitHub <small>MrAntix/Mapping</small></a></p>


        <ul>
          <li><a href="https://github.com/MrAntix/Mapping/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/MrAntix/Mapping/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/MrAntix/Mapping">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <p>This is a simple container for object mapping</p>

<p><a href="https://nuget.org/packages/antix-mapping">On NuGet</a></p>

<p>When you map your objects you get the container passed into the mapper too, this means you can call other mappings from inside your mapping and keep your code all nice and DRY</p>

<h3>Basic Example</h3>

<pre><code>// set up the container in your composite root 
// as a single instance
var mapperContainer = new MapperContainer();

var mapperContainer
    .Register&lt;Person, PersonEntity&gt;(
        (f, t, c) =&gt;
            {
                f.Name = t.Name;
                c.MapAll(f.Addresses, () =&gt; t.Addresses);
            })
    .Register&lt;Address, AddressEntity&gt;(
        (f, t, c) =&gt; { t.Name = f.Name; }
    );

// create a new context as required like so
var mapperContext = new MapperContext(mapperContainer);

// inject the mapping context where you need it
public class PersonController : Controller 
{
    IMapperContext _mapperContext;

    public PersonController(IMapperContext mapperContext)
    {
        _mapperContext = mapperContext;
    }

    ActionResult Update(Person model) {

        var entity = entityService.Load([SomeCriteria]);

        _mapperContext.Map(model, () =&gt; entity);

        entityService.Save(entity);
    }
}
</code></pre>

<p>In this example the registered Address =&gt; AddressEnity mapper is called for the collection of Addresses on the person
Both Person and Address sub-collection objects are mapped</p>

<h3>EntityFramework Example</h3>

<p>You can use the mapper in entity framework by making your DbContext derived class also implement IMappingContext
In this example the IMapperContainer is injected in to the DataContext object</p>

<pre><code>public class DataContext : DbContext, IMapperContext
{
    public DataContext(IMapperContainer container)
    {
        Container = container;
    }

    public IMapperContainer Container { get; private set; }

    public T Create&lt;T&gt;()
    {
        // this function is called by the mapper when 
        // a new entity is needed
        var set = Set(typeof (T));
        return (T) set.Add(set.Create());
    }

    public void Update&lt;T&gt;(T entity)
    {
        // not required for EF
    }

    public void Delete&lt;T&gt;(T entity)
    {
        // this function is called by the mapper when 
        // an entity is deleted
        var set = Set(typeof (T));
        set.Remove(entity);
    }

    ... and other DbContext type stuff 
            IDbSet&lt;PersonEntity&gt; People etc
}
</code></pre>

<p>}</p>

<p>Now you can use the mapping extensions right on your data context</p>

<pre><code>var dataContext = new DataContext(mappingContainer);

dataContext.Map(model, () =&gt; entity);
</code></pre>

<hr><p><em>See the tests for more examples</em></p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/MrAntix">MrAntix</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>